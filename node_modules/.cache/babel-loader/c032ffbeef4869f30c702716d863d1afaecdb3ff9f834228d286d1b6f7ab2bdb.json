{"ast":null,"code":"var _jsxFileName = \"D:\\\\projects\\\\BE MAJOR PROJECT Krutik\\\\client\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\n/* client/src/App.js */\n/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SIO = io(\"http://localhost:5000\");\n\n// ---------- Put the base64 AES key printed by main.py here ----------\nconst DETECTION_KEY_B64 = \"<PASTE_DETECTION_KEY_BASE64_HERE>\";\n// -------------------------------------------------------------------\n\n// helpers: base64 <-> arraybuffer\nfunction b64ToArrayBuffer(b64) {\n  const binary = atob(b64);\n  const len = binary.length;\n  const bytes = new Uint8Array(len);\n  for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);\n  return bytes.buffer;\n}\nfunction arrayBufferToB64(buf) {\n  const bytes = new Uint8Array(buf);\n  let bin = \"\";\n  for (let i = 0; i < bytes.byteLength; i++) bin += String.fromCharCode(bytes[i]);\n  return btoa(bin);\n}\n\n// ECDH (P-256) + AES-GCM helpers (your existing chat key flow)\nasync function generateECDHKeyPair() {\n  const kp = await window.crypto.subtle.generateKey({\n    name: \"ECDH\",\n    namedCurve: \"P-256\"\n  }, true, [\"deriveKey\"]);\n  const pubRaw = await window.crypto.subtle.exportKey(\"raw\", kp.publicKey); // raw format\n  const pubB64 = arrayBufferToB64(pubRaw);\n  return {\n    keyPair: kp,\n    publicKeyB64: pubB64\n  };\n}\nasync function importPeerPublicKey(rawB64) {\n  const raw = b64ToArrayBuffer(rawB64);\n  return window.crypto.subtle.importKey(\"raw\", raw, {\n    name: \"ECDH\",\n    namedCurve: \"P-256\"\n  }, true, []);\n}\nasync function deriveAESGCMKey(ownKP, peerRawB64) {\n  const peerKey = await importPeerPublicKey(peerRawB64);\n  const aesKey = await window.crypto.subtle.deriveKey({\n    name: \"ECDH\",\n    public: peerKey\n  }, ownKP.privateKey, {\n    name: \"AES-GCM\",\n    length: 256\n  }, false, [\"encrypt\", \"decrypt\"]);\n  return aesKey;\n}\nasync function encryptAesGcm(key, plaintext) {\n  const iv = window.crypto.getRandomValues(new Uint8Array(12));\n  const enc = new TextEncoder().encode(plaintext);\n  const ct = await window.crypto.subtle.encrypt({\n    name: \"AES-GCM\",\n    iv\n  }, key, enc);\n  return {\n    ciphertext: arrayBufferToB64(ct),\n    iv: arrayBufferToB64(iv.buffer)\n  };\n}\nasync function decryptAesGcm(key, ciphertextB64, ivB64) {\n  const ivBuf = b64ToArrayBuffer(ivB64);\n  const ctBuf = b64ToArrayBuffer(ciphertextB64);\n  const plainBuf = await window.crypto.subtle.decrypt({\n    name: \"AES-GCM\",\n    iv: new Uint8Array(ivBuf)\n  }, key, ctBuf);\n  return new TextDecoder().decode(plainBuf);\n}\n\n// ---------- RSA/AES helpers used for detection decryption ----------\nasync function importDetectionKeyFromB64(b64) {\n  try {\n    const raw = b64ToArrayBuffer(b64);\n    const key = await window.crypto.subtle.importKey(\"raw\", raw, \"AES-GCM\", false, [\"decrypt\"]);\n    return key;\n  } catch (e) {\n    console.error(\"importDetectionKeyFromB64 failed\", e);\n    return null;\n  }\n}\n\n// ---------- App component ----------\nexport default function App() {\n  _s();\n  // refs\n  const videoRef = useRef(null);\n  const overlayRef = useRef(null);\n  const framesWSRef = useRef(null);\n  const detectWSRef = useRef(null);\n\n  // session / user\n  const [username, setUsername] = useState(\"\");\n  const [peer, setPeer] = useState(\"\");\n  const [connected, setConnected] = useState(false);\n\n  // detections / tracking\n  const [detections, setDetections] = useState([]);\n  const [selected, setSelected] = useState(null);\n\n  // E2EE for chat\n  const localKeyPairRef = useRef(null);\n  const localPubB64Ref = useRef(null);\n  const [peerPubMap, setPeerPubMap] = useState({});\n  const derivedKeysRef = useRef({});\n\n  // detection decrypt key\n  const detectionKeyRef = useRef(null);\n\n  // chats\n  const [chats, setChats] = useState({}); // object_id -> [{sender, plaintext, ts}]\n  const [input, setInput] = useState(\"\");\n\n  // frame sending interval (tune: 250-1000 ms)\n  const FRAME_INTERVAL_MS = 500;\n\n  // init local ECDH keypair on mount\n  useEffect(() => {\n    (async () => {\n      const {\n        keyPair,\n        publicKeyB64\n      } = await generateECDHKeyPair();\n      localKeyPairRef.current = keyPair;\n      localPubB64Ref.current = publicKeyB64;\n    })();\n\n    // import detection AES key (must paste it into DETECTION_KEY_B64)\n    (async () => {\n      if (DETECTION_KEY_B64 && DETECTION_KEY_B64 !== \"<PASTE_DETECTION_KEY_BASE64_HERE>\") {\n        const k = await importDetectionKeyFromB64(DETECTION_KEY_B64);\n        detectionKeyRef.current = k;\n        console.log(\"Detection AES key imported.\");\n      } else {\n        console.warn(\"DETECTION_KEY_B64 not set in App.js. Copy the key printed by main.py into the DETECTION_KEY_B64 constant.\");\n      }\n    })();\n  }, []);\n\n  // Socket.IO handlers (chat + pubkey exchange)\n  useEffect(() => {\n    SIO.on(\"connect\", () => setConnected(true));\n    SIO.on(\"disconnect\", () => setConnected(false));\n    SIO.on(\"message\", async msg => {\n      // msg: { sender, receiver, object_id, text_enc: {ciphertext, iv}, ts }\n      const {\n        sender,\n        object_id,\n        text_enc,\n        ts\n      } = msg;\n      const aesKey = derivedKeysRef.current[sender];\n      if (aesKey && text_enc) {\n        try {\n          const plaintext = await decryptAesGcm(aesKey, text_enc.ciphertext, text_enc.iv);\n          setChats(prev => {\n            const arr = prev[object_id] ? [...prev[object_id]] : [];\n            arr.push({\n              sender,\n              plaintext,\n              ts: ts || Date.now()\n            });\n            return {\n              ...prev,\n              [object_id]: arr\n            };\n          });\n        } catch (e) {\n          setChats(prev => {\n            const arr = prev[object_id] ? [...prev[object_id]] : [];\n            arr.push({\n              sender,\n              plaintext: \"[decryption_failed]\",\n              ts: ts || Date.now()\n            });\n            return {\n              ...prev,\n              [object_id]: arr\n            };\n          });\n        }\n      } else {\n        setChats(prev => {\n          const arr = prev[object_id] ? [...prev[object_id]] : [];\n          arr.push({\n            sender,\n            plaintext: \"[encrypted]\",\n            ts: ts || Date.now()\n          });\n          return {\n            ...prev,\n            [object_id]: arr\n          };\n        });\n      }\n    });\n    SIO.on(\"pubkey_response\", ({\n      peer,\n      publicKeyB64\n    }) => {\n      if (publicKeyB64) setPeerPubMap(prev => ({\n        ...prev,\n        [peer]: publicKeyB64\n      }));\n    });\n    SIO.on(\"peer_pubkey\", async ({\n      from,\n      publicKeyB64\n    }) => {\n      setPeerPubMap(prev => ({\n        ...prev,\n        [from]: publicKeyB64\n      }));\n      if (localKeyPairRef.current) {\n        try {\n          const aes = await deriveAESGCMKey(localKeyPairRef.current, publicKeyB64);\n          derivedKeysRef.current[from] = aes;\n          console.log(\"Derived AES for\", from);\n        } catch (e) {\n          console.warn(\"derive failed\", e);\n        }\n      }\n    });\n    return () => {\n      SIO.off(\"connect\");\n      SIO.off(\"disconnect\");\n      SIO.off(\"message\");\n      SIO.off(\"pubkey_response\");\n      SIO.off(\"peer_pubkey\");\n    };\n  }, []);\n\n  // register & publish pubkey\n  async function handleRegister() {\n    if (!username) return alert(\"Type a username first\");\n    if (!localPubB64Ref.current) {\n      const {\n        keyPair,\n        publicKeyB64\n      } = await generateECDHKeyPair();\n      localKeyPairRef.current = keyPair;\n      localPubB64Ref.current = publicKeyB64;\n    }\n    SIO.emit(\"register\", {\n      username,\n      publicKeyB64: localPubB64Ref.current\n    });\n    alert(`Registered as ${username}`);\n  }\n\n  // request peer key & send our pubkey to peer so both can derive\n  async function establishSharedKeyWithPeer() {\n    if (!peer) return alert(\"Set peer username\");\n    SIO.emit(\"get_pubkey\", {\n      requester: username,\n      peer\n    });\n    setTimeout(async () => {\n      const peerPub = peerPubMap[peer];\n      if (peerPub) {\n        const aes = await deriveAESGCMKey(localKeyPairRef.current, peerPub);\n        derivedKeysRef.current[peer] = aes;\n        // send our public key to peer\n        SIO.emit(\"send_pubkey_to\", {\n          from: username,\n          to: peer,\n          publicKeyB64: localPubB64Ref.current\n        });\n        alert(\"Shared key established (demo)\");\n      } else {\n        alert(\"Peer public key not found — make sure peer registered\");\n      }\n    }, 600);\n  }\n\n  // detection broadcast WS (listen) — receives encrypted detection_broadcast_enc from main.py\n  useEffect(() => {\n    const ws = new WebSocket(\"ws://localhost:7001/ws\");\n    detectWSRef.current = ws;\n    ws.onopen = () => console.log(\"Connected to CV WS (broadcast)\");\n    ws.onmessage = async evt => {\n      try {\n        const data = JSON.parse(evt.data);\n\n        // encrypted detection broadcast\n        if (data.type === \"detection_broadcast_enc\" && data.data) {\n          if (!detectionKeyRef.current) {\n            console.warn(\"No detection key available to decrypt broadcast.\");\n            return;\n          }\n          const {\n            ciphertext_b64,\n            iv_b64\n          } = data.data;\n          try {\n            const ctBuf = b64ToArrayBuffer(ciphertext_b64);\n            const ivBuf = b64ToArrayBuffer(iv_b64);\n            const plainBuf = await window.crypto.subtle.decrypt({\n              name: \"AES-GCM\",\n              iv: new Uint8Array(ivBuf)\n            }, detectionKeyRef.current, ctBuf);\n            const plainText = new TextDecoder().decode(plainBuf);\n            const obj = JSON.parse(plainText);\n            setDetections(obj.detections || []);\n          } catch (e) {\n            console.warn(\"Failed to decrypt detection broadcast\", e);\n          }\n        } else if (data.type === \"info\") {\n          // ignore\n        } else {\n          // fallback: try parsing plaintext detection_broadcast (older compatibility)\n          if (data.type === \"detection_broadcast\" && data.detections) {\n            setDetections(data.detections || []);\n          }\n        }\n      } catch (e) {\n        console.warn(\"Invalid detection data\", e);\n      }\n    };\n    ws.onclose = () => console.log(\"CV WS closed\");\n    return () => ws.close();\n  }, []);\n\n  // frames WS (send frames to main.py/ws_frames)\n  useEffect(() => {\n    let ws = null;\n    let interval = null;\n    let mounted = true;\n    const startFramesWS = async () => {\n      try {\n        ws = new WebSocket(\"ws://localhost:7001/ws_frames\");\n        framesWSRef.current = ws;\n        ws.onopen = () => {\n          console.log(\"frames WS open\");\n        };\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true\n        });\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n          await videoRef.current.play();\n        }\n        interval = setInterval(() => {\n          if (!mounted || !videoRef.current || ws.readyState !== WebSocket.OPEN) return;\n          const canvas = document.createElement(\"canvas\");\n          const sendW = 320,\n            sendH = 240;\n          canvas.width = sendW;\n          canvas.height = sendH;\n          const ctx = canvas.getContext(\"2d\");\n          ctx.drawImage(videoRef.current, 0, 0, sendW, sendH);\n          const dataUrl = canvas.toDataURL(\"image/jpeg\", 0.7);\n          ws.send(dataUrl);\n        }, FRAME_INTERVAL_MS);\n      } catch (e) {\n        console.error(\"frames WS setup failed\", e);\n      }\n    };\n    startFramesWS();\n    return () => {\n      mounted = false;\n      if (interval) clearInterval(interval);\n      if (framesWSRef.current) framesWSRef.current.close();\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(t => t.stop());\n      }\n    };\n  }, []);\n\n  // render overlay (boxes + small last messages)\n  useEffect(() => {\n    const canvas = overlayRef.current;\n    const video = videoRef.current;\n    if (!canvas || !video) return;\n    const ctx = canvas.getContext(\"2d\");\n    let raf;\n    const render = () => {\n      const w = canvas.width = video.clientWidth || 640;\n      const h = canvas.height = video.clientHeight || 480;\n      ctx.clearRect(0, 0, w, h);\n      const srcW = 320,\n        srcH = 240;\n      const sx = w / srcW,\n        sy = h / srcH;\n      for (const d of detections) {\n        const [x1, y1, x2, y2] = d.bbox;\n        const left = x1 * sx,\n          top = y1 * sy,\n          width = (x2 - x1) * sx,\n          height = (y2 - y1) * sy;\n        ctx.lineWidth = selected === d.object_id ? 3 : 2;\n        ctx.strokeStyle = selected === d.object_id ? \"#34d399\" : \"#f59e0b\";\n        ctx.strokeRect(left, top, width, height);\n        ctx.fillStyle = ctx.strokeStyle;\n        ctx.font = \"14px Inter, Arial\";\n        ctx.fillText(`${d.class} ${(d.conf * 100).toFixed(0)}%`, left + 6, top + 18);\n\n        // show latest message for that object (if any)\n        const msgs = chats[d.object_id] || [];\n        const last = msgs.slice(-2);\n        last.forEach((m, idx) => {\n          const text = m.plaintext || m.plain || \"[encrypted]\";\n          const bx = left,\n            by = top + height + 16 + idx * 20;\n          const wText = Math.min(300, ctx.measureText(text).width + 12);\n          ctx.fillStyle = \"rgba(2,6,23,0.9)\";\n          ctx.fillRect(bx, by - 14, wText, 18);\n          ctx.fillStyle = \"#e6eef8\";\n          ctx.fillText(text, bx + 6, by);\n        });\n      }\n      raf = requestAnimationFrame(render);\n    };\n    raf = requestAnimationFrame(render);\n    return () => cancelAnimationFrame(raf);\n  }, [detections, chats, selected]);\n\n  // click video -> pick object id\n  function handleVideoClick(e) {\n    const rect = e.target.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    const srcW = 320,\n      srcH = 240;\n    const scaleX = srcW / rect.width,\n      scaleY = srcH / rect.height;\n    const rx = x * scaleX,\n      ry = y * scaleY;\n    let picked = null;\n    for (const d of detections) {\n      const [x1, y1, x2, y2] = d.bbox;\n      if (rx >= x1 && rx <= x2 && ry >= y1 && ry <= y2) {\n        picked = d.object_id;\n        break;\n      }\n    }\n    setSelected(picked);\n  }\n\n  // send encrypted message attached to selected object\n  async function sendMessage() {\n    if (!username || !peer) return alert(\"set username and peer\");\n    if (!selected) return alert(\"select an object first\");\n    if (!input) return;\n    const aesKey = derivedKeysRef.current[peer];\n    if (!aesKey) return alert(\"no shared key with peer yet — establish key first\");\n    try {\n      const enc = await encryptAesGcm(aesKey, input);\n      const payload = {\n        sender: username,\n        receiver: peer,\n        object_id: selected,\n        text_enc: enc,\n        ts: Date.now()\n      };\n      SIO.emit(\"message\", payload);\n      // optimistic local add\n      setChats(prev => {\n        const arr = prev[selected] ? [...prev[selected]] : [];\n        arr.push({\n          sender: username,\n          plaintext: input,\n          ts: Date.now()\n        });\n        return {\n          ...prev,\n          [selected]: arr\n        };\n      });\n      setInput(\"\");\n    } catch (e) {\n      console.error(\"send failed\", e);\n      alert(\"Failed to encrypt/send message\");\n    }\n  }\n\n  // UI\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      fontFamily: \"Inter, Arial, sans-serif\",\n      background: \"#071021\",\n      minHeight: \"100vh\",\n      color: \"#e6eef8\",\n      padding: 20\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        maxWidth: 1200,\n        margin: \"0 auto 24px\",\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        style: {\n          margin: 0\n        },\n        children: \"ObjectChat \\u2022 Encrypted Object-Anchored Messaging\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: \"#8fb0d6\"\n        },\n        children: connected ? \"Socket connected\" : \"Socket disconnected\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"grid\",\n        gridTemplateColumns: \"320px 1fr 360px\",\n        gap: 16\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: \"#071425\",\n          padding: 12,\n          borderRadius: 10\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: 700,\n            marginBottom: 8\n          },\n          children: \"Session\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 13,\n            color: \"#9fb0d6\"\n          },\n          children: \"Username\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: {\n            width: \"100%\",\n            padding: 8,\n            marginTop: 6,\n            borderRadius: 8,\n            border: \"1px solid #213347\",\n            background: \"#04111a\",\n            color: \"#e6eef8\"\n          },\n          value: username,\n          onChange: e => setUsername(e.target.value),\n          placeholder: \"your name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            height: 10\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 423,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 13,\n            color: \"#9fb0d6\"\n          },\n          children: \"Peer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 424,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          style: {\n            width: \"100%\",\n            padding: 8,\n            marginTop: 6,\n            borderRadius: 8,\n            border: \"1px solid #213347\",\n            background: \"#04111a\",\n            color: \"#e6eef8\"\n          },\n          value: peer,\n          onChange: e => setPeer(e.target.value),\n          placeholder: \"peer username\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 425,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: \"flex\",\n            gap: 8,\n            marginTop: 10\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleRegister,\n            style: {\n              padding: \"8px 12px\",\n              borderRadius: 8,\n              background: \"#06b6d4\",\n              border: \"none\",\n              cursor: \"pointer\"\n            },\n            children: \"Register\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 428,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: establishSharedKeyWithPeer,\n            style: {\n              padding: \"8px 12px\",\n              borderRadius: 8,\n              background: \"#1f6f9b\",\n              border: \"none\",\n              cursor: \"pointer\"\n            },\n            children: \"Establish Key\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 427,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            height: 12\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 13,\n            color: \"#9fb0d6\",\n            marginBottom: 6\n          },\n          children: \"Selected object\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: 8,\n            background: \"#031422\",\n            borderRadius: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 700\n            },\n            children: selected || \"None\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 12,\n              color: \"#7f9bb3\",\n              marginTop: 6\n            },\n            children: [detections.length, \" objects in view\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 436,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            height: 12\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 13,\n            color: \"#9fb0d6\"\n          },\n          children: \"Encrypted Message\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          value: input,\n          onChange: e => setInput(e.target.value),\n          placeholder: \"Type message...\",\n          rows: 5,\n          style: {\n            width: \"100%\",\n            marginTop: 8,\n            borderRadius: 8,\n            background: \"#04111a\",\n            color: \"#e6eef8\",\n            border: \"1px solid #213347\",\n            padding: 8\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 441,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: \"flex\",\n            gap: 8,\n            marginTop: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: sendMessage,\n            style: {\n              padding: \"8px 12px\",\n              borderRadius: 8,\n              background: \"#16a34a\",\n              border: \"none\",\n              cursor: \"pointer\"\n            },\n            children: \"Send\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 444,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setInput(\"\"),\n            style: {\n              padding: \"8px 12px\",\n              borderRadius: 8,\n              background: \"#1f6f9b\",\n              border: \"none\"\n            },\n            children: \"Clear\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 445,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            height: 12\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 13,\n            color: \"#9fb0d6\"\n          },\n          children: \"Known peer public keys\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 449,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: 8,\n            maxHeight: 160,\n            overflowY: \"auto\",\n            background: \"#041426\",\n            padding: 8,\n            borderRadius: 8\n          },\n          children: [Object.keys(peerPubMap).length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              color: \"#5f7f9f\"\n            },\n            children: \"No peer public keys yet\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 55\n          }, this), Object.entries(peerPubMap).map(([u, k]) => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 8\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontWeight: 700\n              },\n              children: u\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 454,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: 12,\n                color: \"#7f9bb3\",\n                wordBreak: \"break-all\"\n              },\n              children: [k.slice(0, 60), k.length > 60 ? \"...\" : \"\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 455,\n              columnNumber: 17\n            }, this)]\n          }, u, true, {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 450,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: \"#071425\",\n          padding: 12,\n          borderRadius: 10\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: 700,\n            marginBottom: 8\n          },\n          children: \"Live Camera\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 462,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: \"100%\",\n            position: \"relative\",\n            background: \"#000\",\n            borderRadius: 8,\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"video\", {\n            ref: videoRef,\n            onClick: handleVideoClick,\n            style: {\n              width: \"100%\",\n              height: 480,\n              objectFit: \"cover\"\n            },\n            autoPlay: true,\n            muted: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 464,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: overlayRef,\n            style: {\n              position: \"absolute\",\n              left: 0,\n              top: 0,\n              pointerEvents: \"none\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 465,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 463,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: 10,\n            display: \"flex\",\n            gap: 8\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 13,\n              color: \"#9fb0d6\"\n            },\n            children: \"Tip: click a bounding box to select object\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 468,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: \"#071425\",\n          padding: 12,\n          borderRadius: 10\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: 700,\n            marginBottom: 8\n          },\n          children: \"Object Chat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 473,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 13,\n            color: \"#9fb0d6\",\n            marginBottom: 8\n          },\n          children: \"Messages for selected object\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 474,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            maxHeight: 480,\n            overflowY: \"auto\",\n            paddingRight: 8\n          },\n          children: selected && chats[selected] ? chats[selected].map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"flex\",\n              flexDirection: m.sender === username ? \"row-reverse\" : \"row\",\n              marginBottom: 10\n            },\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                maxWidth: \"80%\",\n                background: m.sender === username ? \"#0ea5a4\" : \"#0b1226\",\n                color: m.sender === username ? \"#02120f\" : \"#e6eef8\",\n                padding: 10,\n                borderRadius: 10\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontSize: 14,\n                  fontWeight: 600\n                },\n                children: m.plaintext || m.plain || \"[encrypted]\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 479,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontSize: 11,\n                  color: \"#8ba0c0\",\n                  marginTop: 6\n                },\n                children: [m.sender, \" \\u2022 \", new Date(m.ts || Date.now()).toLocaleTimeString()]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 480,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 478,\n              columnNumber: 17\n            }, this)\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 477,\n            columnNumber: 15\n          }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              color: \"#5f7f9f\"\n            },\n            children: \"Select an object to see messages\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 483,\n            columnNumber: 18\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 475,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 411,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"kw7Y5yuYTajYmGSWgpOpvU40eb0=\");\n_c = App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useEffect","useRef","useState","io","jsxDEV","_jsxDEV","SIO","DETECTION_KEY_B64","b64ToArrayBuffer","b64","binary","atob","len","length","bytes","Uint8Array","i","charCodeAt","buffer","arrayBufferToB64","buf","bin","byteLength","String","fromCharCode","btoa","generateECDHKeyPair","kp","window","crypto","subtle","generateKey","name","namedCurve","pubRaw","exportKey","publicKey","pubB64","keyPair","publicKeyB64","importPeerPublicKey","rawB64","raw","importKey","deriveAESGCMKey","ownKP","peerRawB64","peerKey","aesKey","deriveKey","public","privateKey","encryptAesGcm","key","plaintext","iv","getRandomValues","enc","TextEncoder","encode","ct","encrypt","ciphertext","decryptAesGcm","ciphertextB64","ivB64","ivBuf","ctBuf","plainBuf","decrypt","TextDecoder","decode","importDetectionKeyFromB64","e","console","error","App","_s","videoRef","overlayRef","framesWSRef","detectWSRef","username","setUsername","peer","setPeer","connected","setConnected","detections","setDetections","selected","setSelected","localKeyPairRef","localPubB64Ref","peerPubMap","setPeerPubMap","derivedKeysRef","detectionKeyRef","chats","setChats","input","setInput","FRAME_INTERVAL_MS","current","k","log","warn","on","msg","sender","object_id","text_enc","ts","prev","arr","push","Date","now","from","aes","off","handleRegister","alert","emit","establishSharedKeyWithPeer","requester","setTimeout","peerPub","to","ws","WebSocket","onopen","onmessage","evt","data","JSON","parse","type","ciphertext_b64","iv_b64","plainText","obj","onclose","close","interval","mounted","startFramesWS","stream","navigator","mediaDevices","getUserMedia","video","srcObject","play","setInterval","readyState","OPEN","canvas","document","createElement","sendW","sendH","width","height","ctx","getContext","drawImage","dataUrl","toDataURL","send","clearInterval","tracks","getTracks","forEach","t","stop","raf","render","w","clientWidth","h","clientHeight","clearRect","srcW","srcH","sx","sy","d","x1","y1","x2","y2","bbox","left","top","lineWidth","strokeStyle","strokeRect","fillStyle","font","fillText","class","conf","toFixed","msgs","last","slice","m","idx","text","plain","bx","by","wText","Math","min","measureText","fillRect","requestAnimationFrame","cancelAnimationFrame","handleVideoClick","rect","target","getBoundingClientRect","x","clientX","y","clientY","scaleX","scaleY","rx","ry","picked","sendMessage","payload","receiver","style","fontFamily","background","minHeight","color","padding","children","maxWidth","margin","display","justifyContent","alignItems","fileName","_jsxFileName","lineNumber","columnNumber","gridTemplateColumns","gap","borderRadius","fontWeight","marginBottom","fontSize","marginTop","border","value","onChange","placeholder","onClick","cursor","rows","maxHeight","overflowY","Object","keys","entries","map","u","wordBreak","position","overflow","ref","objectFit","autoPlay","muted","pointerEvents","paddingRight","flexDirection","toLocaleTimeString","_c","$RefreshReg$"],"sources":["D:/projects/BE MAJOR PROJECT Krutik/client/src/App.js"],"sourcesContent":["/* client/src/App.js */\n/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { io } from \"socket.io-client\";\n\nconst SIO = io(\"http://localhost:5000\");\n\n// ---------- Put the base64 AES key printed by main.py here ----------\nconst DETECTION_KEY_B64 = \"<PASTE_DETECTION_KEY_BASE64_HERE>\";\n// -------------------------------------------------------------------\n\n// helpers: base64 <-> arraybuffer\nfunction b64ToArrayBuffer(b64) {\n  const binary = atob(b64);\n  const len = binary.length;\n  const bytes = new Uint8Array(len);\n  for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);\n  return bytes.buffer;\n}\nfunction arrayBufferToB64(buf) {\n  const bytes = new Uint8Array(buf);\n  let bin = \"\";\n  for (let i = 0; i < bytes.byteLength; i++) bin += String.fromCharCode(bytes[i]);\n  return btoa(bin);\n}\n\n// ECDH (P-256) + AES-GCM helpers (your existing chat key flow)\nasync function generateECDHKeyPair() {\n  const kp = await window.crypto.subtle.generateKey(\n    { name: \"ECDH\", namedCurve: \"P-256\" },\n    true,\n    [\"deriveKey\"]\n  );\n  const pubRaw = await window.crypto.subtle.exportKey(\"raw\", kp.publicKey); // raw format\n  const pubB64 = arrayBufferToB64(pubRaw);\n  return { keyPair: kp, publicKeyB64: pubB64 };\n}\nasync function importPeerPublicKey(rawB64) {\n  const raw = b64ToArrayBuffer(rawB64);\n  return window.crypto.subtle.importKey(\"raw\", raw, { name: \"ECDH\", namedCurve: \"P-256\" }, true, []);\n}\nasync function deriveAESGCMKey(ownKP, peerRawB64) {\n  const peerKey = await importPeerPublicKey(peerRawB64);\n  const aesKey = await window.crypto.subtle.deriveKey(\n    { name: \"ECDH\", public: peerKey },\n    ownKP.privateKey,\n    { name: \"AES-GCM\", length: 256 },\n    false,\n    [\"encrypt\", \"decrypt\"]\n  );\n  return aesKey;\n}\nasync function encryptAesGcm(key, plaintext) {\n  const iv = window.crypto.getRandomValues(new Uint8Array(12));\n  const enc = new TextEncoder().encode(plaintext);\n  const ct = await window.crypto.subtle.encrypt({ name: \"AES-GCM\", iv }, key, enc);\n  return { ciphertext: arrayBufferToB64(ct), iv: arrayBufferToB64(iv.buffer) };\n}\nasync function decryptAesGcm(key, ciphertextB64, ivB64) {\n  const ivBuf = b64ToArrayBuffer(ivB64);\n  const ctBuf = b64ToArrayBuffer(ciphertextB64);\n  const plainBuf = await window.crypto.subtle.decrypt({ name: \"AES-GCM\", iv: new Uint8Array(ivBuf) }, key, ctBuf);\n  return new TextDecoder().decode(plainBuf);\n}\n\n// ---------- RSA/AES helpers used for detection decryption ----------\nasync function importDetectionKeyFromB64(b64) {\n  try {\n    const raw = b64ToArrayBuffer(b64);\n    const key = await window.crypto.subtle.importKey(\"raw\", raw, \"AES-GCM\", false, [\"decrypt\"]);\n    return key;\n  } catch (e) {\n    console.error(\"importDetectionKeyFromB64 failed\", e);\n    return null;\n  }\n}\n\n// ---------- App component ----------\nexport default function App() {\n  // refs\n  const videoRef = useRef(null);\n  const overlayRef = useRef(null);\n  const framesWSRef = useRef(null);\n  const detectWSRef = useRef(null);\n\n  // session / user\n  const [username, setUsername] = useState(\"\");\n  const [peer, setPeer] = useState(\"\");\n  const [connected, setConnected] = useState(false);\n\n  // detections / tracking\n  const [detections, setDetections] = useState([]);\n  const [selected, setSelected] = useState(null);\n\n  // E2EE for chat\n  const localKeyPairRef = useRef(null);\n  const localPubB64Ref = useRef(null);\n  const [peerPubMap, setPeerPubMap] = useState({});\n  const derivedKeysRef = useRef({});\n\n  // detection decrypt key\n  const detectionKeyRef = useRef(null);\n\n  // chats\n  const [chats, setChats] = useState({}); // object_id -> [{sender, plaintext, ts}]\n  const [input, setInput] = useState(\"\");\n\n  // frame sending interval (tune: 250-1000 ms)\n  const FRAME_INTERVAL_MS = 500;\n\n  // init local ECDH keypair on mount\n  useEffect(() => {\n    (async () => {\n      const { keyPair, publicKeyB64 } = await generateECDHKeyPair();\n      localKeyPairRef.current = keyPair;\n      localPubB64Ref.current = publicKeyB64;\n    })();\n\n    // import detection AES key (must paste it into DETECTION_KEY_B64)\n    (async () => {\n      if (DETECTION_KEY_B64 && DETECTION_KEY_B64 !== \"<PASTE_DETECTION_KEY_BASE64_HERE>\") {\n        const k = await importDetectionKeyFromB64(DETECTION_KEY_B64);\n        detectionKeyRef.current = k;\n        console.log(\"Detection AES key imported.\");\n      } else {\n        console.warn(\"DETECTION_KEY_B64 not set in App.js. Copy the key printed by main.py into the DETECTION_KEY_B64 constant.\");\n      }\n    })();\n  }, []);\n\n  // Socket.IO handlers (chat + pubkey exchange)\n  useEffect(() => {\n    SIO.on(\"connect\", () => setConnected(true));\n    SIO.on(\"disconnect\", () => setConnected(false));\n\n    SIO.on(\"message\", async (msg) => {\n      // msg: { sender, receiver, object_id, text_enc: {ciphertext, iv}, ts }\n      const { sender, object_id, text_enc, ts } = msg;\n      const aesKey = derivedKeysRef.current[sender];\n      if (aesKey && text_enc) {\n        try {\n          const plaintext = await decryptAesGcm(aesKey, text_enc.ciphertext, text_enc.iv);\n          setChats(prev => {\n            const arr = prev[object_id] ? [...prev[object_id]] : [];\n            arr.push({ sender, plaintext, ts: ts || Date.now() });\n            return { ...prev, [object_id]: arr };\n          });\n        } catch (e) {\n          setChats(prev => {\n            const arr = prev[object_id] ? [...prev[object_id]] : [];\n            arr.push({ sender, plaintext: \"[decryption_failed]\", ts: ts || Date.now() });\n            return { ...prev, [object_id]: arr };\n          });\n        }\n      } else {\n        setChats(prev => {\n          const arr = prev[object_id] ? [...prev[object_id]] : [];\n          arr.push({ sender, plaintext: \"[encrypted]\", ts: ts || Date.now() });\n          return { ...prev, [object_id]: arr };\n        });\n      }\n    });\n\n    SIO.on(\"pubkey_response\", ({ peer, publicKeyB64 }) => {\n      if (publicKeyB64) setPeerPubMap(prev => ({ ...prev, [peer]: publicKeyB64 }));\n    });\n\n    SIO.on(\"peer_pubkey\", async ({ from, publicKeyB64 }) => {\n      setPeerPubMap(prev => ({ ...prev, [from]: publicKeyB64 }));\n      if (localKeyPairRef.current) {\n        try {\n          const aes = await deriveAESGCMKey(localKeyPairRef.current, publicKeyB64);\n          derivedKeysRef.current[from] = aes;\n          console.log(\"Derived AES for\", from);\n        } catch (e) {\n          console.warn(\"derive failed\", e);\n        }\n      }\n    });\n\n    return () => {\n      SIO.off(\"connect\");\n      SIO.off(\"disconnect\");\n      SIO.off(\"message\");\n      SIO.off(\"pubkey_response\");\n      SIO.off(\"peer_pubkey\");\n    };\n  }, []);\n\n  // register & publish pubkey\n  async function handleRegister() {\n    if (!username) return alert(\"Type a username first\");\n    if (!localPubB64Ref.current) {\n      const { keyPair, publicKeyB64 } = await generateECDHKeyPair();\n      localKeyPairRef.current = keyPair;\n      localPubB64Ref.current = publicKeyB64;\n    }\n    SIO.emit(\"register\", { username, publicKeyB64: localPubB64Ref.current });\n    alert(`Registered as ${username}`);\n  }\n\n  // request peer key & send our pubkey to peer so both can derive\n  async function establishSharedKeyWithPeer() {\n    if (!peer) return alert(\"Set peer username\");\n    SIO.emit(\"get_pubkey\", { requester: username, peer });\n    setTimeout(async () => {\n      const peerPub = peerPubMap[peer];\n      if (peerPub) {\n        const aes = await deriveAESGCMKey(localKeyPairRef.current, peerPub);\n        derivedKeysRef.current[peer] = aes;\n        // send our public key to peer\n        SIO.emit(\"send_pubkey_to\", { from: username, to: peer, publicKeyB64: localPubB64Ref.current });\n        alert(\"Shared key established (demo)\");\n      } else {\n        alert(\"Peer public key not found — make sure peer registered\");\n      }\n    }, 600);\n  }\n\n  // detection broadcast WS (listen) — receives encrypted detection_broadcast_enc from main.py\n  useEffect(() => {\n    const ws = new WebSocket(\"ws://localhost:7001/ws\");\n    detectWSRef.current = ws;\n    ws.onopen = () => console.log(\"Connected to CV WS (broadcast)\");\n    ws.onmessage = async (evt) => {\n      try {\n        const data = JSON.parse(evt.data);\n\n        // encrypted detection broadcast\n        if (data.type === \"detection_broadcast_enc\" && data.data) {\n          if (!detectionKeyRef.current) {\n            console.warn(\"No detection key available to decrypt broadcast.\");\n            return;\n          }\n          const { ciphertext_b64, iv_b64 } = data.data;\n          try {\n            const ctBuf = b64ToArrayBuffer(ciphertext_b64);\n            const ivBuf = b64ToArrayBuffer(iv_b64);\n            const plainBuf = await window.crypto.subtle.decrypt(\n              { name: \"AES-GCM\", iv: new Uint8Array(ivBuf) },\n              detectionKeyRef.current,\n              ctBuf\n            );\n            const plainText = new TextDecoder().decode(plainBuf);\n            const obj = JSON.parse(plainText);\n            setDetections(obj.detections || []);\n          } catch (e) {\n            console.warn(\"Failed to decrypt detection broadcast\", e);\n          }\n        } else if (data.type === \"info\") {\n          // ignore\n        } else {\n          // fallback: try parsing plaintext detection_broadcast (older compatibility)\n          if (data.type === \"detection_broadcast\" && data.detections) {\n            setDetections(data.detections || []);\n          }\n        }\n      } catch (e) {\n        console.warn(\"Invalid detection data\", e);\n      }\n    };\n    ws.onclose = () => console.log(\"CV WS closed\");\n    return () => ws.close();\n  }, []);\n\n  // frames WS (send frames to main.py/ws_frames)\n  useEffect(() => {\n    let ws = null;\n    let interval = null;\n    let mounted = true;\n\n    const startFramesWS = async () => {\n      try {\n        ws = new WebSocket(\"ws://localhost:7001/ws_frames\");\n        framesWSRef.current = ws;\n\n        ws.onopen = () => {\n          console.log(\"frames WS open\");\n        };\n\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n          await videoRef.current.play();\n        }\n\n        interval = setInterval(() => {\n          if (!mounted || !videoRef.current || ws.readyState !== WebSocket.OPEN) return;\n          const canvas = document.createElement(\"canvas\");\n          const sendW = 320, sendH = 240;\n          canvas.width = sendW; canvas.height = sendH;\n          const ctx = canvas.getContext(\"2d\");\n          ctx.drawImage(videoRef.current, 0, 0, sendW, sendH);\n          const dataUrl = canvas.toDataURL(\"image/jpeg\", 0.7);\n          ws.send(dataUrl);\n        }, FRAME_INTERVAL_MS);\n      } catch (e) {\n        console.error(\"frames WS setup failed\", e);\n      }\n    };\n\n    startFramesWS();\n\n    return () => {\n      mounted = false;\n      if (interval) clearInterval(interval);\n      if (framesWSRef.current) framesWSRef.current.close();\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(t => t.stop());\n      }\n    };\n  }, []);\n\n  // render overlay (boxes + small last messages)\n  useEffect(() => {\n    const canvas = overlayRef.current;\n    const video = videoRef.current;\n    if (!canvas || !video) return;\n    const ctx = canvas.getContext(\"2d\");\n    let raf;\n    const render = () => {\n      const w = canvas.width = video.clientWidth || 640;\n      const h = canvas.height = video.clientHeight || 480;\n      ctx.clearRect(0,0,w,h);\n\n      const srcW = 320, srcH = 240;\n      const sx = w / srcW, sy = h / srcH;\n\n      for (const d of detections) {\n        const [x1,y1,x2,y2] = d.bbox;\n        const left = x1 * sx, top = y1 * sy, width = (x2-x1) * sx, height = (y2-y1) * sy;\n        ctx.lineWidth = selected === d.object_id ? 3 : 2;\n        ctx.strokeStyle = selected === d.object_id ? \"#34d399\" : \"#f59e0b\";\n        ctx.strokeRect(left, top, width, height);\n        ctx.fillStyle = ctx.strokeStyle;\n        ctx.font = \"14px Inter, Arial\";\n        ctx.fillText(`${d.class} ${(d.conf*100).toFixed(0)}%`, left + 6, top + 18);\n\n        // show latest message for that object (if any)\n        const msgs = chats[d.object_id] || [];\n        const last = msgs.slice(-2);\n        last.forEach((m, idx) => {\n          const text = m.plaintext || m.plain || \"[encrypted]\";\n          const bx = left, by = top + height + 16 + idx*20;\n          const wText = Math.min(300, ctx.measureText(text).width + 12);\n          ctx.fillStyle = \"rgba(2,6,23,0.9)\";\n          ctx.fillRect(bx, by - 14, wText, 18);\n          ctx.fillStyle = \"#e6eef8\";\n          ctx.fillText(text, bx + 6, by);\n        });\n      }\n\n      raf = requestAnimationFrame(render);\n    };\n    raf = requestAnimationFrame(render);\n    return () => cancelAnimationFrame(raf);\n  }, [detections, chats, selected]);\n\n  // click video -> pick object id\n  function handleVideoClick(e) {\n    const rect = e.target.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    const srcW = 320, srcH = 240;\n    const scaleX = srcW / rect.width, scaleY = srcH / rect.height;\n    const rx = x * scaleX, ry = y * scaleY;\n    let picked = null;\n    for (const d of detections) {\n      const [x1,y1,x2,y2] = d.bbox;\n      if (rx >= x1 && rx <= x2 && ry >= y1 && ry <= y2) {\n        picked = d.object_id;\n        break;\n      }\n    }\n    setSelected(picked);\n  }\n\n  // send encrypted message attached to selected object\n  async function sendMessage() {\n    if (!username || !peer) return alert(\"set username and peer\");\n    if (!selected) return alert(\"select an object first\");\n    if (!input) return;\n    const aesKey = derivedKeysRef.current[peer];\n    if (!aesKey) return alert(\"no shared key with peer yet — establish key first\");\n    try {\n      const enc = await encryptAesGcm(aesKey, input);\n      const payload = {\n        sender: username,\n        receiver: peer,\n        object_id: selected,\n        text_enc: enc,\n        ts: Date.now()\n      };\n      SIO.emit(\"message\", payload);\n      // optimistic local add\n      setChats(prev => {\n        const arr = prev[selected] ? [...prev[selected]] : [];\n        arr.push({ sender: username, plaintext: input, ts: Date.now() });\n        return { ...prev, [selected]: arr };\n      });\n      setInput(\"\");\n    } catch (e) {\n      console.error(\"send failed\", e);\n      alert(\"Failed to encrypt/send message\");\n    }\n  }\n\n  // UI\n  return (\n    <div style={{ fontFamily: \"Inter, Arial, sans-serif\", background: \"#071021\", minHeight: \"100vh\", color: \"#e6eef8\", padding: 20 }}>\n      <div style={{ maxWidth: 1200, margin: \"0 auto 24px\", display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n        <h2 style={{ margin: 0 }}>ObjectChat • Encrypted Object-Anchored Messaging</h2>\n        <div style={{ color: \"#8fb0d6\" }}>{ connected ? \"Socket connected\" : \"Socket disconnected\" }</div>\n      </div>\n\n      <div style={{ display: \"grid\", gridTemplateColumns: \"320px 1fr 360px\", gap: 16 }}>\n        <div style={{ background: \"#071425\", padding: 12, borderRadius: 10 }}>\n          <div style={{ fontWeight: 700, marginBottom: 8 }}>Session</div>\n          <div style={{ fontSize: 13, color: \"#9fb0d6\" }}>Username</div>\n          <input style={{ width: \"100%\", padding: 8, marginTop:6, borderRadius:8, border:\"1px solid #213347\", background:\"#04111a\", color:\"#e6eef8\" }}\n                 value={username} onChange={e=>setUsername(e.target.value)} placeholder=\"your name\" />\n          <div style={{ height: 10 }} />\n          <div style={{ fontSize: 13, color: \"#9fb0d6\" }}>Peer</div>\n          <input style={{ width: \"100%\", padding: 8, marginTop:6, borderRadius:8, border:\"1px solid #213347\", background:\"#04111a\", color:\"#e6eef8\" }}\n                 value={peer} onChange={e=>setPeer(e.target.value)} placeholder=\"peer username\" />\n          <div style={{ display:\"flex\", gap:8, marginTop:10 }}>\n            <button onClick={handleRegister} style={{ padding:\"8px 12px\", borderRadius:8, background:\"#06b6d4\", border:\"none\", cursor:\"pointer\" }}>Register</button>\n            <button onClick={establishSharedKeyWithPeer} style={{ padding:\"8px 12px\", borderRadius:8, background:\"#1f6f9b\", border:\"none\", cursor:\"pointer\" }}>Establish Key</button>\n          </div>\n\n          <div style={{ height: 12 }} />\n          <div style={{ fontSize: 13, color:\"#9fb0d6\", marginBottom:6 }}>Selected object</div>\n          <div style={{ padding:8, background:\"#031422\", borderRadius:8 }}>\n            <div style={{ fontWeight:700 }}>{ selected || \"None\" }</div>\n            <div style={{ fontSize:12, color:\"#7f9bb3\", marginTop:6 }}>{ detections.length } objects in view</div>\n          </div>\n\n          <div style={{ height:12 }} />\n          <div style={{ fontSize:13, color:\"#9fb0d6\" }}>Encrypted Message</div>\n          <textarea value={input} onChange={(e)=>setInput(e.target.value)} placeholder=\"Type message...\" rows={5}\n                    style={{ width:\"100%\", marginTop:8, borderRadius:8, background:\"#04111a\", color:\"#e6eef8\", border:\"1px solid #213347\", padding:8 }} />\n          <div style={{ display:\"flex\", gap:8, marginTop:8 }}>\n            <button onClick={sendMessage} style={{ padding:\"8px 12px\", borderRadius:8, background:\"#16a34a\", border:\"none\", cursor:\"pointer\" }}>Send</button>\n            <button onClick={()=>setInput(\"\")} style={{ padding:\"8px 12px\", borderRadius:8, background:\"#1f6f9b\", border:\"none\" }}>Clear</button>\n          </div>\n\n          <div style={{ height:12 }} />\n          <div style={{ fontSize:13, color:\"#9fb0d6\" }}>Known peer public keys</div>\n          <div style={{ marginTop:8, maxHeight:160, overflowY:\"auto\", background:\"#041426\", padding:8, borderRadius:8 }}>\n            { Object.keys(peerPubMap).length === 0 && <div style={{ color:\"#5f7f9f\" }}>No peer public keys yet</div> }\n            { Object.entries(peerPubMap).map(([u, k]) => (\n              <div key={u} style={{ marginBottom:8 }}>\n                <div style={{ fontWeight:700 }}>{u}</div>\n                <div style={{ fontSize:12, color:\"#7f9bb3\", wordBreak:\"break-all\" }}>{k.slice(0,60)}{k.length>60?\"...\":\"\"}</div>\n              </div>\n            )) }\n          </div>\n        </div>\n\n        <div style={{ background:\"#071425\", padding:12, borderRadius:10 }}>\n          <div style={{ fontWeight:700, marginBottom:8 }}>Live Camera</div>\n          <div style={{ width:\"100%\", position:\"relative\", background:\"#000\", borderRadius:8, overflow:\"hidden\" }}>\n            <video ref={videoRef} onClick={handleVideoClick} style={{ width:\"100%\", height:480, objectFit:\"cover\" }} autoPlay muted />\n            <canvas ref={overlayRef} style={{ position:\"absolute\", left:0, top:0, pointerEvents:\"none\" }} />\n          </div>\n          <div style={{ marginTop:10, display:\"flex\", gap:8 }}>\n            <div style={{ fontSize:13, color:\"#9fb0d6\" }}>Tip: click a bounding box to select object</div>\n          </div>\n        </div>\n\n        <div style={{ background:\"#071425\", padding:12, borderRadius:10 }}>\n          <div style={{ fontWeight:700, marginBottom:8 }}>Object Chat</div>\n          <div style={{ fontSize:13, color:\"#9fb0d6\", marginBottom:8 }}>Messages for selected object</div>\n          <div style={{ maxHeight:480, overflowY:\"auto\", paddingRight:8 }}>\n            { selected && chats[selected] ? chats[selected].map((m, i) => (\n              <div key={i} style={{ display:\"flex\", flexDirection: m.sender === username ? \"row-reverse\" : \"row\", marginBottom:10 }}>\n                <div style={{ maxWidth:\"80%\", background: m.sender === username ? \"#0ea5a4\" : \"#0b1226\", color: m.sender === username ? \"#02120f\" : \"#e6eef8\", padding:10, borderRadius:10 }}>\n                  <div style={{ fontSize:14, fontWeight:600 }}>{m.plaintext || m.plain || \"[encrypted]\"}</div>\n                  <div style={{ fontSize:11, color:\"#8ba0c0\", marginTop:6 }}>{m.sender} • {new Date(m.ts||Date.now()).toLocaleTimeString()}</div>\n                </div>\n              </div>\n            )) : <div style={{ color:\"#5f7f9f\" }}>Select an object to see messages</div> }\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}